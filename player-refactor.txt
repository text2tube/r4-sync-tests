# Player Refactor Plan

## Phase 1: Fix Core Functionality (MVP)
**Goal:** Make play/pause/next/expand buttons work reliably

### 1. Fix Play/Pause Synchronization
- **Problem:** Custom buttons and media-chrome buttons not syncing properly
- **Solution:** Ensure YouTube player dispatches standard `play`/`pause` events that media-chrome can listen to
- **Tasks:**
  - Remove duplicate `<media-play-button>` from control bar (line 179 in player.svelte)
  - Verify `youtube-video` element properly dispatches events
  - Test custom `togglePlay()` function with media-chrome state
  - Add event listeners to keep `app_state.is_playing` in sync

### 2. Clean Up Control Duplication
- Remove duplicate `<media-time-range>` and `<media-time-display>` elements (lines 177, 183-184)
- Decide which controls to show in compact vs expanded modes
- Ensure media-chrome controls don't conflict with custom menu buttons

### 3. Improve Compact/Expanded Toggle
- Rename CSS classes from `.player:not(.expanded)` to `.player.compact` for clarity
- Ensure `upupup()` function properly toggles both UI state and app_state
- Test responsive behavior in both modes

### 4. Fix Next/Previous Buttons
- Verify track queue logic works correctly
- Ensure proper error handling when no next/previous track available

## Phase 2: Responsive Polish (Future)
- Implement media-chrome breakpoints for better responsive control
- Fine-tune layout for different screen sizes
- Add gesture support if needed
- Optimize performance

## Key Files to Modify:
- `src/lib/components/player.svelte` (main cleanup)
- `src/lib/components/youtube-player.svelte` (event handling)
- `src/lib/api/player.js` (button logic)

## Testing Strategy:
- Test play/pause sync in both compact and expanded modes
- Verify next/previous navigation works
- Test responsive behavior across different screen sizes
- Ensure YouTube player events properly propagate

## Current Issues Identified:
1. Duplicate `<media-play-button>` in control bar conflicts with custom play button
2. Duplicate `<media-time-range>` and `<media-time-display>` elements
3. CSS uses confusing `.player:not(.expanded)` instead of `.player.compact`
4. Play/pause state sync between custom buttons and YouTube player